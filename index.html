<!DOCTYPE html>
<html lang="pt-BR">
<head> 
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ruê Cachos – Calculadora de Precificação</title>
<meta name="theme-color" content="#8a3d2b" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
:root {--bg:#fff;--panel:#fff;--muted:#7a3f2f;--text:#2b1b16;--brand:#8a3d2b;--accent:#f1d5c9;--border:#e5e7eb;--shadow:rgba(17,24,39,.08)}
html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#fff;color:var(--text)}
.container{max-width:1000px;margin:24px auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;box-shadow:0 6px 25px var(--shadow)}
h1{display:flex;align-items:center;gap:10px;margin:0 0 8px;font-size:clamp(20px,3vw,28px);color:var(--brand)}
h1 img{height:50px;width:auto;border-radius:8px;box-shadow:0 0 6px rgba(0,0,0,.05)}
.sub{color:var(--muted);font-size:14px;margin-bottom:12px}
fieldset{border:1px dashed var(--border);border-radius:14px;padding:12px;margin:0 0 12px}
legend{color:var(--brand);font-size:13px;font-weight:600;padding:0 6px}
label{display:flex;justify-content:space-between;align-items:baseline;gap:8px;font-size:13px;color:#3c2b26;margin:8px 0 2px}
.hint{font-size:11px;color:var(--muted)}
input,select{width:100%;box-sizing:border-box;background:#fff;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;outline:none;transition:.2s}
input:focus,select:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(138,61,43,.15)}
.grid{display:grid;gap:16px}
@media(min-width:960px){.grid{grid-template-columns:1.2fr .8fr}}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.kpi{display:grid;gap:10px}
.tile{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px}
.title{font-size:11px;color:var(--muted)}
.value{font-size:22px;font-weight:800;color:var(--brand)}
.money{font-variant-numeric:tabular-nums}
button{background:var(--brand);color:#fff;font-weight:700;border:none;border-radius:10px;padding:12px 14px;cursor:pointer;transition:.2s}
button:hover{opacity:.9} button.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
.pill{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--accent);color:var(--brand);font-size:11px;margin-left:6px;font-weight:600}
.foot{margin-top:10px;font-size:11px;color:var(--muted)}
</style>
</head>
<body>
  <div class="container">
    <div class="card" style="margin-bottom:14px">
      <!-- Logo do símbolo embutida (data URI simples para não depender de arquivos externos) -->
      <h1><img alt="Logo Ruê"
       src="./SIMBOLO-01.jpg" style="height:50px;width:auto;border-radius:8px;object-fit:contain"        Ruê Cachos – Precificação <span class="pill">v1.2</span></h1>
      <div class="sub">Informe o preço e a quantidade por embalagem (tinta e oxidante). Depois digite o consumido e, se houver, até dois outros produtos. O app calcula <strong>ÓTIMO</strong>, <strong>IDEAL</strong> e <strong>LIMITE</strong> com metas travadas (8% / 10% / 12%) e arredondamento em R$ 5.</div>
      <div class="actions" style="margin-top:10px">
        <button id="save" type="button">Salvar padrões</button>
        <button class="ghost" id="reset" type="button">Resetar</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <form id="calc" onsubmit="return false">
          <fieldset>
            <legend>Tinta</legend>
            <div class="row3">
              <div><label>Preço do tubo (R$)</label><input type="text" inputmode="decimal" id="tuboPreco" value="60,00" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Quantidade por tubo (g)</label><input type="text" inputmode="numeric" id="tuboGramas" value="500" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Usado no atendimento (g)</label><input type="text" inputmode="numeric" id="tintaUsadaG" value="40" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
            </div>
            <div class="hint">Preço calculado por grama: <span id="tintaRpg">R$ 0,00</span></div>
          </fieldset>

          <fieldset>
            <legend>Oxidante</legend>
            <div class="row3">
              <div><label>Preço da embalagem (R$)</label><input type="text" inputmode="decimal" id="oxPreco" value="20,00" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Quantidade por embalagem (ml)</label><input type="text" inputmode="numeric" id="oxMlEmb" value="1000" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Usado no atendimento (ml)</label><input type="text" inputmode="numeric" id="oxUsadoMl" value="60" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
            </div>
            <div class="hint">Preço calculado por ml: <span id="oxRpm">R$ 0,00</span></div>
          </fieldset>

          <fieldset>
            <legend>Outros produtos</legend>
            <div class="row3">
              <div><label>Nome do item 1</label><input type="text" id="o1Nome" value="Tratamento"></div>
              <div><label>Preço unitário (R$)</label><input type="text" inputmode="decimal" id="o1Preco" value="0,00" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Quantidade</label><input type="text" inputmode="decimal" id="o1Qtd" value="0" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
            </div>
            <div class="row3">
              <div><label>Nome do item 2</label><input type="text" id="o2Nome" value="Aditivo/Booster"></div>
              <div><label>Preço unitário (R$)</label><input type="text" inputmode="decimal" id="o2Preco" value="0,00" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
              <div><label>Quantidade</label><input type="text" inputmode="decimal" id="o2Qtd" value="0" oninput="calc()" onchange="calc()" onkeyup="calc()"></div>
            </div>
            <div class="row2">
              <div><label>Total de outros produtos (R$)</label><input type="text" id="outrosTotal" disabled></div>
            </div>
          </fieldset>
        </form>
      </div>

      <div class="card">
        <div class="kpi">
          <div class="tile"><div class="title">Custo total de produtos</div><div class="value money" id="vCusto">R$ 0,00</div></div>
          <div class="tile"><div class="title">Preço – ÓTIMO</div><div class="value money" id="pOtimo">R$ 0,00</div></div>
          <div class="tile"><div class="title">Preço – IDEAL</div><div class="value money" id="pIdeal">R$ 0,00</div></div>
          <div class="tile"><div class="title">Preço – LIMITE</div><div class="value money" id="pLimite">R$ 0,00</div></div>
        </div>
        <div class="foot">Metas fixas 8/10/12. Arredondamento R$ 5. Funciona offline.</div>
      </div>
    </div>
  </div>

  <script>
  const $ = (s) => document.getElementById(s);
  const money = (v)=> (isFinite(v)? v:0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const roundToStep = (v, step)=>{const s=Number(step)||1;return Math.round((v||0)/s)*s};

  // normaliza números (vírgula -> ponto, remove espaços)
  const num = (id) => {
    const el = $(id); if(!el) return 0;
    const raw = String(el.value||'').replace(/\s+/g,'').replace(/\./g,'.').replace(/,/g,'.');
    const n = parseFloat(raw.replace(/[^\d\.-]/g,''));
    return isFinite(n) ? n : 0;
  };

  function calc(){
    const tuboPreco = num('tuboPreco');
    const tuboGramas= num('tuboGramas');
    const tintaUsadaG= num('tintaUsadaG');
    const tintaRpg   = tuboGramas>0 ? (tuboPreco / tuboGramas) : 0;
    $('tintaRpg').textContent = money(tintaRpg);

    const oxPreco   = num('oxPreco');
    const oxMlEmb   = num('oxMlEmb');
    const oxUsadoMl = num('oxUsadoMl');
    const oxRpm     = oxMlEmb>0 ? (oxPreco / oxMlEmb) : 0;
    $('oxRpm').textContent = money(oxRpm);

    const o1Preco = num('o1Preco'); const o1Qtd = num('o1Qtd'); const o1Sub=o1Preco*o1Qtd;
    const o2Preco = num('o2Preco'); const o2Qtd = num('o2Qtd'); const o2Sub=o2Preco*o2Qtd;
    const outrosTotal = o1Sub+o2Sub; $('outrosTotal').value = money(outrosTotal);

    const custo = (tintaRpg * tintaUsadaG) + (oxRpm * oxUsadoMl) + outrosTotal;
    $('vCusto').textContent = money(custo);

    const ROUND_STEP = 5;
    const metas = Object.freeze({ otimo:0.08, ideal:0.10, limite:0.12 });
    $('pOtimo').textContent = money(roundToStep(custo/metas.otimo, ROUND_STEP));
    $('pIdeal').textContent = money(roundToStep(custo/metas.ideal, ROUND_STEP));
    $('pLimite').textContent = money(roundToStep(custo/metas.limite, ROUND_STEP));
    return true;
  }

  // Eventos (inclui Safari + reforços)
  const listenIds = ['tuboPreco','tuboGramas','tintaUsadaG','oxPreco','oxMlEmb','oxUsadoMl','o1Preco','o1Qtd','o2Preco','o2Qtd'];
  listenIds.forEach(id=>{ const el=$(id); if(el){ ['input','change','blur','keyup'].forEach(evt=> el.addEventListener(evt, calc)); }});
  const form = $('calc'); if(form){ form.addEventListener('input', calc, true); form.addEventListener('change', calc, true); }
  window.addEventListener('pageshow', ()=>{ try{ calc(); }catch(e){} });
  try{ window.__rueInterval && clearInterval(window.__rueInterval); }catch(e){}
  window.__rueInterval = setInterval(()=>{ try{ calc(); }catch(e){} }, 700);

  // Salvar padrões localmente
  function saveDefaults(){ const data={}; listenIds.concat(['o1Nome','o2Nome']).forEach(id=>{const el=$(id); if(el) data[id]=el.value;}); localStorage.setItem('pricing_por_consumo_defaults', JSON.stringify(data)); alert('Padrões salvos.'); }
  function loadDefaults(){ const raw=localStorage.getItem('pricing_por_consumo_defaults'); if(!raw) return; try{ const d=JSON.parse(raw); Object.keys(d).forEach(k=>{ if($(k)) $(k).value=d[k]; }); }catch(e){} }
  function resetAll(){ localStorage.removeItem('pricing_por_consumo_defaults'); location.reload(); }
  const btnS=$('save'), btnR=$('reset'); if(btnS) btnS.addEventListener('click', saveDefaults); if(btnR) btnR.addEventListener('click', resetAll);

  // Service Worker via BLOB (sem arquivo externo): offline mesmo 1-arquivo
  if ('serviceWorker' in navigator) {
    const swCode = `
      const CACHE='rue-calc-onefile-v1';
      self.addEventListener('install',e=>{self.skipWaiting()});
      self.addEventListener('activate',e=>{e.waitUntil(clients.claim())});
      self.addEventListener('fetch',e=>{ e.respondWith(fetch(e.request).catch(()=>new Response('<h1>Offline</h1>',{headers:{'Content-Type':'text/html'}}))); });
    `;
    const blob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(blob);
    window.addEventListener('load', ()=> navigator.serviceWorker.register(swUrl).catch(console.error));
  }

  loadDefaults(); calc();
  </script>
</body>
</html>


